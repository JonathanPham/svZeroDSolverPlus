\hypertarget{csvwriter_8hpp_source}{}\doxysection{csvwriter.\+hpp}
\label{csvwriter_8hpp_source}\index{io/csvwriter.hpp@{io/csvwriter.hpp}}
\mbox{\hyperlink{csvwriter_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/**}}
\DoxyCodeLine{2 \textcolor{comment}{ * @file csvwriter.hpp}}
\DoxyCodeLine{3 \textcolor{comment}{ * @brief IO::write\_csv source file}}
\DoxyCodeLine{4 \textcolor{comment}{ */}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#ifndef SVZERODSOLVER\_IO\_CSVWRITER\_HPP\_}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#define SVZERODSOLVER\_IO\_CSVWRITER\_HPP\_}}
\DoxyCodeLine{7 }
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <fstream>}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include <string>}}
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{11 }
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include "{}../algebra/state.hpp"{}}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include "{}../helpers/startswith.hpp"{}}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include "{}../model/model.hpp"{}}}
\DoxyCodeLine{15 }
\DoxyCodeLine{16 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespace_i_o}{IO}} \{}
\DoxyCodeLine{17 \textcolor{comment}{}}
\DoxyCodeLine{18 \textcolor{comment}{/**}}
\DoxyCodeLine{19 \textcolor{comment}{ * @brief Write the node solutions to a csv file}}
\DoxyCodeLine{20 \textcolor{comment}{ *}}
\DoxyCodeLine{21 \textcolor{comment}{ * @tparam T Scalar type (e.g. `float`, `double`)}}
\DoxyCodeLine{22 \textcolor{comment}{ * @param times Sequence of time steps corresponding to the solutions}}
\DoxyCodeLine{23 \textcolor{comment}{ * @param states Sequence of states corresponding to the time steps}}
\DoxyCodeLine{24 \textcolor{comment}{ * @param model The underlying model}}
\DoxyCodeLine{25 \textcolor{comment}{ * @param mean Toggle whether only the mean over all time steps should be}}
\DoxyCodeLine{26 \textcolor{comment}{ * written}}
\DoxyCodeLine{27 \textcolor{comment}{ * @return CSV encoded output string}}
\DoxyCodeLine{28 \textcolor{comment}{ */}}
\DoxyCodeLine{29 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{30 std::string \mbox{\hyperlink{namespace_i_o_a3ca9ad0179e52f455094b9e6143943e7}{write\_csv\_nodes}}(std::vector<T> \&times,}
\DoxyCodeLine{31                       std::vector<\mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_state}{ALGEBRA::State<T>}}> \&states,}
\DoxyCodeLine{32                       \mbox{\hyperlink{class_m_o_d_e_l_1_1_model}{MODEL::Model<T>}} \&model, \textcolor{keywordtype}{bool} mean = \textcolor{keyword}{false}) \{}
\DoxyCodeLine{33   \textcolor{comment}{// Create string stream to buffer output}}
\DoxyCodeLine{34   std::stringstream out;}
\DoxyCodeLine{35 }
\DoxyCodeLine{36   \textcolor{comment}{// Write column labels}}
\DoxyCodeLine{37   out << \textcolor{stringliteral}{"{}name,time,flow,pressure\(\backslash\)n"{}};}
\DoxyCodeLine{38 }
\DoxyCodeLine{39   \textcolor{comment}{// Create buffer for lines}}
\DoxyCodeLine{40   \textcolor{keywordtype}{char} buff[130];}
\DoxyCodeLine{41 }
\DoxyCodeLine{42   \textcolor{comment}{// Determine number of time steps}}
\DoxyCodeLine{43   T num\_steps = times.size();}
\DoxyCodeLine{44 }
\DoxyCodeLine{45   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} flow\_dof;}
\DoxyCodeLine{46   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} pres\_dof;}
\DoxyCodeLine{47   std::string name;}
\DoxyCodeLine{48   }
\DoxyCodeLine{49   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} node : model.\mbox{\hyperlink{class_m_o_d_e_l_1_1_model_a513272238d7c4f37a4351ab9d7d825e6}{nodes}}) \{}
\DoxyCodeLine{50     name = node.name;}
\DoxyCodeLine{51     flow\_dof = node.flow\_dof;}
\DoxyCodeLine{52     pres\_dof = node.pres\_dof;}
\DoxyCodeLine{53     \textcolor{comment}{// Write the solution of the node to the output file}}
\DoxyCodeLine{54     \textcolor{keywordflow}{if} (mean) \{}
\DoxyCodeLine{55       T flow\_mean = 0.0;}
\DoxyCodeLine{56       T pres\_mean = 0.0;}
\DoxyCodeLine{57       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < times.size(); i++) \{}
\DoxyCodeLine{58         flow\_mean += states[i].y[flow\_dof];}
\DoxyCodeLine{59         pres\_mean += states[i].y[pres\_dof];}
\DoxyCodeLine{60       \}}
\DoxyCodeLine{61       flow\_mean /= num\_steps;}
\DoxyCodeLine{62       pres\_mean /= num\_steps;}
\DoxyCodeLine{63       sprintf(buff, \textcolor{stringliteral}{"{}\%s,,\%.16e,\%.16e\(\backslash\)n"{}}, name.c\_str(), flow\_mean, pres\_mean);}
\DoxyCodeLine{64       out << buff;}
\DoxyCodeLine{65     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{66       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < times.size(); i++) \{}
\DoxyCodeLine{67         sprintf(buff, \textcolor{stringliteral}{"{}\%s,\%.16e,\%.16e,\%.16e\(\backslash\)n"{}}, name.c\_str(),}
\DoxyCodeLine{68                 times[i], states[i].y[flow\_dof], states[i].y[pres\_dof]);}
\DoxyCodeLine{69         out << buff;}
\DoxyCodeLine{70       \}}
\DoxyCodeLine{71     \}}
\DoxyCodeLine{72   \}}
\DoxyCodeLine{73   \textcolor{keywordflow}{return} out.str();}
\DoxyCodeLine{74 \}}
\DoxyCodeLine{75 \textcolor{comment}{}}
\DoxyCodeLine{76 \textcolor{comment}{/**}}
\DoxyCodeLine{77 \textcolor{comment}{ * @brief Write the blood vessel solutions to a csv file}}
\DoxyCodeLine{78 \textcolor{comment}{ *}}
\DoxyCodeLine{79 \textcolor{comment}{ * @tparam T Scalar type (e.g. `float`, `double`)}}
\DoxyCodeLine{80 \textcolor{comment}{ * @param times Sequence of time steps corresponding to the solutions}}
\DoxyCodeLine{81 \textcolor{comment}{ * @param states Sequence of states corresponding to the time steps}}
\DoxyCodeLine{82 \textcolor{comment}{ * @param model The underlying model}}
\DoxyCodeLine{83 \textcolor{comment}{ * @param mean Toggle whether only the mean over all time steps should be}}
\DoxyCodeLine{84 \textcolor{comment}{ * written}}
\DoxyCodeLine{85 \textcolor{comment}{ * @return CSV encoded output string}}
\DoxyCodeLine{86 \textcolor{comment}{ */}}
\DoxyCodeLine{87 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{88 std::string \mbox{\hyperlink{namespace_i_o_a8c06f173c59142eaa97b25404df25ef9}{write\_csv\_vessels}}(std::vector<T> \&times,}
\DoxyCodeLine{89                       std::vector<\mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_state}{ALGEBRA::State<T>}}> \&states,}
\DoxyCodeLine{90                       \mbox{\hyperlink{class_m_o_d_e_l_1_1_model}{MODEL::Model<T>}} \&model, \textcolor{keywordtype}{bool} mean = \textcolor{keyword}{false}) \{}
\DoxyCodeLine{91   \textcolor{comment}{// Create string stream to buffer output}}
\DoxyCodeLine{92   std::stringstream out;}
\DoxyCodeLine{93 }
\DoxyCodeLine{94   \textcolor{comment}{// Write column labels}}
\DoxyCodeLine{95   out << \textcolor{stringliteral}{"{}name,time,flow\_in,flow\_out,pressure\_in,pressure\_out\(\backslash\)n"{}};}
\DoxyCodeLine{96 }
\DoxyCodeLine{97   \textcolor{comment}{// Create buffer for lines}}
\DoxyCodeLine{98   \textcolor{keywordtype}{char} buff[130];}
\DoxyCodeLine{99 }
\DoxyCodeLine{100   \textcolor{comment}{// Determine number of time steps}}
\DoxyCodeLine{101   T num\_steps = times.size();}
\DoxyCodeLine{102 }
\DoxyCodeLine{103   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} inflow\_dof;}
\DoxyCodeLine{104   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} outflow\_dof;}
\DoxyCodeLine{105   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} inpres\_dof;}
\DoxyCodeLine{106   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} outpres\_dof;}
\DoxyCodeLine{107   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} \&[key, elem] : model.\mbox{\hyperlink{class_m_o_d_e_l_1_1_model_adbd91c5205700c4628b2eeea20ea404f}{blocks}}) \{}
\DoxyCodeLine{108     \textcolor{comment}{// Extract global solution indices of the block}}
\DoxyCodeLine{109     std::string name = \textcolor{stringliteral}{"{}NoName"{}};}
\DoxyCodeLine{110     std::visit(}
\DoxyCodeLine{111         [\&](\textcolor{keyword}{auto} \&\&block) \{}
\DoxyCodeLine{112           \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespace_h_e_l_p_e_r_s_aa60c2dfbfc096834b6cd243f84b9c47b}{HELPERS::startswith}}(block.name, \textcolor{stringliteral}{"{}V"{}})) \{}
\DoxyCodeLine{113             name = block.name;}
\DoxyCodeLine{114           \textcolor{comment}{//inflow\_dof = block.inlet\_nodes[0]-\/>flow\_dof;}}
\DoxyCodeLine{115           \textcolor{comment}{//outflow\_dof = block.outlet\_nodes[0]-\/>flow\_dof;}}
\DoxyCodeLine{116           \textcolor{comment}{//inpres\_dof = block.inlet\_nodes[0]-\/>pres\_dof;}}
\DoxyCodeLine{117           \textcolor{comment}{//outpres\_dof = block.outlet\_nodes[0]-\/>pres\_dof;}}
\DoxyCodeLine{118             inflow\_dof = block.global\_var\_ids[1];}
\DoxyCodeLine{119             outflow\_dof = block.global\_var\_ids[3];}
\DoxyCodeLine{120             inpres\_dof = block.global\_var\_ids[0];}
\DoxyCodeLine{121             outpres\_dof = block.global\_var\_ids[2];}
\DoxyCodeLine{122           \}}
\DoxyCodeLine{123         \},}
\DoxyCodeLine{124         elem);}
\DoxyCodeLine{125 }
\DoxyCodeLine{126     \textcolor{comment}{// Write the solution of the block to the output file}}
\DoxyCodeLine{127     \textcolor{keywordflow}{if} (name != \textcolor{stringliteral}{"{}NoName"{}}) \{}
\DoxyCodeLine{128       \textcolor{keywordflow}{if} (mean) \{}
\DoxyCodeLine{129         T inflow\_mean = 0.0;}
\DoxyCodeLine{130         T outflow\_mean = 0.0;}
\DoxyCodeLine{131         T inpres\_mean = 0.0;}
\DoxyCodeLine{132         T outpres\_mean = 0.0;}
\DoxyCodeLine{133         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < times.size(); i++) \{}
\DoxyCodeLine{134           inflow\_mean += states[i].y[inflow\_dof];}
\DoxyCodeLine{135           outflow\_mean += states[i].y[outflow\_dof];}
\DoxyCodeLine{136           inpres\_mean += states[i].y[inpres\_dof];}
\DoxyCodeLine{137           outpres\_mean += states[i].y[outpres\_dof];}
\DoxyCodeLine{138         \}}
\DoxyCodeLine{139         inflow\_mean /= num\_steps;}
\DoxyCodeLine{140         outflow\_mean /= num\_steps;}
\DoxyCodeLine{141         inpres\_mean /= num\_steps;}
\DoxyCodeLine{142         outpres\_mean /= num\_steps;}
\DoxyCodeLine{143         sprintf(buff, \textcolor{stringliteral}{"{}\%s,,\%.16e,\%.16e,\%.16e,\%.16e\(\backslash\)n"{}}, name.c\_str(),}
\DoxyCodeLine{144                 inflow\_mean, outflow\_mean, inpres\_mean, outpres\_mean);}
\DoxyCodeLine{145         out << buff;}
\DoxyCodeLine{146       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{147         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < times.size(); i++) \{}
\DoxyCodeLine{148           sprintf(buff, \textcolor{stringliteral}{"{}\%s,\%.16e,\%.16e,\%.16e,\%.16e,\%.16e\(\backslash\)n"{}}, name.c\_str(),}
\DoxyCodeLine{149                   times[i], states[i].y[inflow\_dof], states[i].y[outflow\_dof],}
\DoxyCodeLine{150                   states[i].y[inpres\_dof], states[i].y[outpres\_dof]);}
\DoxyCodeLine{151           out << buff;}
\DoxyCodeLine{152         \}}
\DoxyCodeLine{153       \}}
\DoxyCodeLine{154     \}}
\DoxyCodeLine{155   \}}
\DoxyCodeLine{156 }
\DoxyCodeLine{157   \textcolor{keywordflow}{return} out.str();}
\DoxyCodeLine{158 \}}
\DoxyCodeLine{159 \textcolor{comment}{}}
\DoxyCodeLine{160 \textcolor{comment}{/**}}
\DoxyCodeLine{161 \textcolor{comment}{ * @brief Write the solution of internal variables to a csv file}}
\DoxyCodeLine{162 \textcolor{comment}{ *}}
\DoxyCodeLine{163 \textcolor{comment}{ * @tparam T Scalar type (e.g. `float`, `double`)}}
\DoxyCodeLine{164 \textcolor{comment}{ * @param times Sequence of time steps corresponding to the solutions}}
\DoxyCodeLine{165 \textcolor{comment}{ * @param states Sequence of states corresponding to the time steps}}
\DoxyCodeLine{166 \textcolor{comment}{ * @param model The underlying model}}
\DoxyCodeLine{167 \textcolor{comment}{ * @param mean Toggle whether only the mean over all time steps should be}}
\DoxyCodeLine{168 \textcolor{comment}{ * written}}
\DoxyCodeLine{169 \textcolor{comment}{ * @return CSV encoded output string}}
\DoxyCodeLine{170 \textcolor{comment}{ */}}
\DoxyCodeLine{171 \textcolor{keyword}{template} <\textcolor{keyword}{typename} T>}
\DoxyCodeLine{172 std::string \mbox{\hyperlink{namespace_i_o_a267b12d2dc2f10d909162e9c45d0f0ae}{write\_csv\_internal\_vars}}(std::vector<T> \&times,}
\DoxyCodeLine{173                       std::vector<\mbox{\hyperlink{class_a_l_g_e_b_r_a_1_1_state}{ALGEBRA::State<T>}}> \&states,}
\DoxyCodeLine{174                       \mbox{\hyperlink{class_m_o_d_e_l_1_1_model}{MODEL::Model<T>}} \&model, \textcolor{keywordtype}{bool} mean = \textcolor{keyword}{false}) \{}
\DoxyCodeLine{175   \textcolor{comment}{// Create string stream to buffer output}}
\DoxyCodeLine{176   std::stringstream out;}
\DoxyCodeLine{177 }
\DoxyCodeLine{178   \textcolor{comment}{// Write column labels}}
\DoxyCodeLine{179   out << \textcolor{stringliteral}{"{}name,time,value\(\backslash\)n"{}};}
\DoxyCodeLine{180 }
\DoxyCodeLine{181   \textcolor{comment}{// Create buffer for lines}}
\DoxyCodeLine{182   \textcolor{keywordtype}{char} buff[130];}
\DoxyCodeLine{183 }
\DoxyCodeLine{184   \textcolor{comment}{// Determine number of time steps}}
\DoxyCodeLine{185   T num\_steps = times.size();}
\DoxyCodeLine{186 }
\DoxyCodeLine{187   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} var\_dof;}
\DoxyCodeLine{188   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} num\_vars;}
\DoxyCodeLine{189   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} num\_inlets; }
\DoxyCodeLine{190   \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} num\_outlets;}
\DoxyCodeLine{191 }
\DoxyCodeLine{192   \textcolor{comment}{// Write internal variables}}
\DoxyCodeLine{193   \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} \&[key, elem] : model.\mbox{\hyperlink{class_m_o_d_e_l_1_1_model_adbd91c5205700c4628b2eeea20ea404f}{blocks}}) \{}
\DoxyCodeLine{194     std::string name = \textcolor{stringliteral}{"{}NoName"{}};}
\DoxyCodeLine{195     std::visit([\&](\textcolor{keyword}{auto} \&\&block) \{}
\DoxyCodeLine{196       num\_vars = block.global\_var\_ids.size();}
\DoxyCodeLine{197       num\_inlets = block.inlet\_nodes.size(); }
\DoxyCodeLine{198       num\_outlets = block.outlet\_nodes.size();}
\DoxyCodeLine{199       \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} var\_id = 2*(num\_inlets+num\_outlets); var\_id < num\_vars; var\_id++) \{}
\DoxyCodeLine{200         name = \textcolor{stringliteral}{"{}var\_"{}} + std::to\_string(var\_id) + \textcolor{stringliteral}{"{}\_"{}} + block.name;}
\DoxyCodeLine{201         var\_dof = block.global\_var\_ids[var\_id];}
\DoxyCodeLine{202         \textcolor{keywordflow}{if} (mean) \{}
\DoxyCodeLine{203           T var\_mean = 0.0;}
\DoxyCodeLine{204           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < times.size(); i++) \{}
\DoxyCodeLine{205             var\_mean += states[i].y[var\_dof];}
\DoxyCodeLine{206           \}}
\DoxyCodeLine{207           var\_mean /= num\_steps;}
\DoxyCodeLine{208           sprintf(buff, \textcolor{stringliteral}{"{}\%s,,\%.16e\(\backslash\)n"{}}, name.c\_str(), var\_mean);}
\DoxyCodeLine{209           out << buff;}
\DoxyCodeLine{210         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{211           \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i < times.size(); i++) \{}
\DoxyCodeLine{212             sprintf(buff, \textcolor{stringliteral}{"{}\%s,\%.16e,\%.16e\(\backslash\)n"{}}, name.c\_str(),}
\DoxyCodeLine{213                     times[i], states[i].y[var\_dof]);}
\DoxyCodeLine{214             out << buff;}
\DoxyCodeLine{215           \}}
\DoxyCodeLine{216         \}}
\DoxyCodeLine{217       \}}
\DoxyCodeLine{218     \},}
\DoxyCodeLine{219     elem);}
\DoxyCodeLine{220   \}}
\DoxyCodeLine{221   \textcolor{keywordflow}{return} out.str();}
\DoxyCodeLine{222 \}}
\DoxyCodeLine{223 \}  \textcolor{comment}{// namespace IO}}
\DoxyCodeLine{224 }
\DoxyCodeLine{225 \textcolor{preprocessor}{\#endif  }\textcolor{comment}{// SVZERODSOLVER\_IO\_CSVWRITER\_HPP\_}}

\end{DoxyCode}
